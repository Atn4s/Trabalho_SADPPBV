<!DOCTYPE html>
<html>

<head>
    <title>Front End</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #options {
            display: none;
            margin-top: 20px;
        }

        button {
            margin-right: 10px;
        }
    </style>
</head>

<body>

    <div id="options">
        <button id="logoutButton" onclick="fazerLogout()">Logout</button>
        <button id="listUsersButton" onclick="listarUsuarios()">Listar Usuários</button>
        <button id="createUserButton" onclick="criarUsuario()">Cadastrar Usuário</button>
    </div>

    <script>
        const IP = prompt('Digite o IP do servidor:');
        const PORT = prompt('Digite a porta do servidor:');
        let token = '';

        const login = function () {
            const registro = prompt('Digite o registro:');
            const senha = prompt('Digite a senha:');

            $.ajax({
                url: `http://${IP}:${PORT}/login`,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    registro: registro,
                    senha: senha
                }),
                success: function (response) {
                    console.log(response);
                    token = response.token;
                    document.getElementById('options').style.display = 'block';
                },
                error: function (error) {
                    console.error(error);
                }
            });
        };

        function fazerLogout() {
            $.ajax({
                url: `http://${IP}:${PORT}/logout`,
                type: 'POST',
                contentType: 'application/json',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                success: function (response) {
                    console.log(response);
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }

        let tableVisible = false; // Variável para controlar a visibilidade da tabela
        let table; // Variável para a tabela

        function toggleTable() {
            table = document.getElementById('tableUsuarios');
            if (tableVisible) {
                table.style.display = 'none'; // Esconde a tabela se estiver visível
                tableVisible = false;
            } else {
                table.style.display = 'block'; // Mostra a tabela se estiver oculta
                tableVisible = true;
            }
        }

        function listarUsuarios() {
            $.ajax({
                url: `http://${IP}:${PORT}/usuarios`,
                type: 'GET',
                contentType: 'application/json',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                success: function (response) {
                    console.log(response);
                    const usuarios = response.usuarios; // Supondo que 'usuarios' seja um array de objetos contendo informações dos usuários

                    // Limpar a tabela antes de adicionar novos dados
                    table = document.getElementById('tableUsuarios');
                    if (table) {
                        table.innerHTML = '';
                    } else {
                        table = document.createElement('table');
                        table.id = 'tableUsuarios';
                        document.body.appendChild(table);
                    }

                    // Adicionar os dados dos usuários à tabela
                    const tableBody = document.createElement('tbody');
                    for (let i = 0; i < usuarios.length; i++) {
                        const usuario = usuarios[i];
                        const row = tableBody.insertRow(i);

                        const cell1 = row.insertCell(0);
                        cell1.innerHTML = usuario.nome;

                        const cell2 = row.insertCell(1);
                        cell2.innerHTML = usuario.registro;

                        const cell3 = row.insertCell(2);
                        cell3.innerHTML = usuario.email;

                        const cell4 = row.insertCell(3);
                        cell4.innerHTML = usuario.tipo_usuario === 1 ? 'Administrador' : 'Usuário Comum';
                    }
                    table.appendChild(tableBody);
                    toggleTable(); // Chama a função para alternar a visibilidade da tabela
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }


        function criarUsuario() {
            const nome = prompt('Digite o nome do usuário:');
            const registro = prompt('Digite o registro do usuário:');
            const email = prompt('Digite o e-mail do usuário:');
            const senha = prompt('Digite a senha do usuário:');
            const tipo_usuario = prompt('Digite o tipo de usuário (1 para administrador, 0 para usuário comum):');

            const novoUsuario = {
                nome: nome,
                registro: registro,
                email: email,
                senha: senha,
                tipo_usuario: parseInt(tipo_usuario)
            };

            $.ajax({
                url: `http://${IP}:${PORT}/usuarios`,
                type: 'POST',
                contentType: 'application/json',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                data: JSON.stringify(novoUsuario),
                success: function (response) {
                    console.log(response);
                },
                error: function (error) {
                    console.error(error);
                }
            });
        }

        login();
    </script>

</body>

</html>

